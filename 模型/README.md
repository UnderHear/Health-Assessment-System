# 成老年人运动处方智能推荐系统V1.0

## 系统概述

这是一个基于知识图谱（KG）、检索增强生成（RAG）和大语言模型（LLM）技术的智能运动处方推荐系统。系统专为20-79岁年龄段的人群设计，能够根据用户的体质测试指标、运动偏好、风险等级和疾病情况，生成个性化的运动处方方案。

## 核心功能

1. **基于知识图谱的结构化知识检索**
   - 整合专业运动医学知识，提供准确的健康建议
   - 针对不同体质指标和健康状况的精准知识匹配

2. **年龄段智能适配**
   - 20-49岁：完整评估13项体质指标，包括纵跳等年轻人专属测试
   - 50-59岁：评估12项体质指标，优化中老年人的运动推荐
   - 60-79岁：提供适合老年人的8项体质指标评估和安全性优先的运动方案

3. **个性化运动处方生成**
   - 根据综合评级动态调整总训练周期
   - 训练周期依据循序渐进原则划分为不同训练阶段
   - 充分考虑用户的运动偏好、风险等级和疾病情况

4. **实时流式输出**
   - AI生成内容时实时显示，无需等待全部生成完成
   - 提供流畅的用户体验

5. **RAG动作方案库集成**
   - 集成专业动作方案库，提供具体可行的运动指导
   - 基于用户特征智能检索最适合的动作方案

## 技术架构

系统采用模块化设计，主要包含以下核心组件：

1. **核心服务层** (`src/core/core_service.py`)
   - `IntegratedFitnessRAGService`：整合KG、RAG和LLM的核心服务类
   - 体质指标评估、综合评级计算、运动处方生成和报告生成

2. **知识图谱模块** (`src/kg/`)
   - 管理结构化的运动医学知识
   - 支持基于用户特征的知识检索

3. **RAG检索增强模块** (`src/rag/`)
   - `FAISSRetriever`：基于FAISS的高效向量检索器
   - `BGEReranker`：基于BGE模型的检索结果重排器
   - `RAGPipeline`：整合检索和重排功能的流水线

4. **LLM交互模块** (`src/llm/`)
   - `DeepSeekAPIClient`：与DeepSeek大语言模型交互
   - 支持流式文本生成

5. **数据加载模块** (`src/utils/data_loader.py`)
   - `FitnessDataLoader`：加载体质测试数据、运动偏好和疾病列表

6. **配置管理** (`src/config/config.py`)
   - 集中管理系统配置和环境变量

## 环境要求

### 硬件要求
- 最低配置：8GB RAM，4核CPU
- 推荐配置：16GB RAM，8核CPU
- 可选GPU加速：支持CUDA的NVIDIA GPU

### 软件要求
- Python 3.8+
- 依赖包见requirements.txt

## 安装指南

1. **克隆或下载项目**

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **配置环境变量**
   - 复制 `.env.example` 为 `.env`
   - 设置DeepSeek API密钥和其他必要配置

4. **准备数据文件**
   - 确保以下文件存在于 `data/` 目录中：
     - `RAG-动作方案库.xlsx`：动作方案库
     - 知识图谱相关文件
     - 体质评价标准文件

## 使用方法

### 交互式演示

运行主程序启动交互式演示：

```bash
python main处方推荐模型.py
```

根据提示输入以下信息：
1. 年龄（20-79岁）
2. 性别（男/女）
3. 各项体质测试指标（可选，可跳过）
4. 运动偏好（最多2项）
5. 运动风险等级（低/中/高）
6. 疾病情况（多个用逗号分隔）

系统将自动分析数据并生成个性化运动处方报告。

### 注意事项
- 输入'exit'可以随时退出程序
- 直接回车可跳过可选指标输入
- 系统会对异常输入值进行验证和提示

## 系统流程

1. **数据输入与验证**
   - 收集用户基本信息和体质测试数据
   - 根据年龄段显示不同的测试指标输入项
   - 验证输入数据的合理性

2. **体质指标评估**
   - 基于年龄段和性别选择相应的评价标准
   - 对各项体质指标进行评分

3. **综合评级计算**
   - 采用加权计算方法得到综合评级
   - 根据综合评级确定总训练周期

4. **专业知识检索**
   - 从知识图谱检索相关专业知识
   - 从动作方案库检索适合的运动方案

5. **运动处方生成**
   - 结合用户特征和专业知识生成个性化方案
   - 根据风险等级调整运动强度和类型

6. **实时流式输出**
   - 即时显示AI生成的分析报告和运动处方

## 支持的体质指标

### 通用指标（所有年龄段）
- 身高、体重、BMI
- 体脂率
- 肺活量
- 坐位体前屈（柔韧性）
- 闭眼单脚站立（平衡能力）
- 选择反应时间（反应能力）
- 握力（力量）

### 成年人特有指标（20-59岁）
- 最大摄氧量相对值
- 一分钟仰卧起坐
- 俯卧撑/跪卧撑
- 纵跳（20-49岁）

### 老年人特有指标（60-79岁）
- 2分钟原地高抬腿
- 30秒坐站次数

## 示例输入与输出

### 输入示例
```
请输入年龄（数字，20-79岁）：35
请输入性别（男/女）：男
请输入身高（单位：cm）：175
请输入体重（单位：kg）：70
请输入运动偏好1（如：健步走）：游泳
请输入运动风险等级（低/中/高）：低
```

### 输出示例
系统将生成包含以下内容的运动处方报告：
- 体质状况分析
- 综合评级
- 个性化运动处方（包含总周期、阶段划分）
- 运动建议和注意事项
- 饮食和恢复建议

## 故障排除

### 常见问题

1. **系统初始化失败**
   - 检查DeepSeek API密钥是否正确设置
   - 确认FAISS索引和知识图谱文件路径是否存在
   - 检查网络连接是否正常

2. **数据加载错误**
   - 确保Excel文件格式正确
   - 检查文件编码和路径

3. **流式输出异常**
   - 检查Python版本是否支持相应的流处理功能
   - 查看控制台错误信息

## 扩展与定制

### 添加新的动作方案
1. 在 `data/RAG-动作方案库.xlsx` 中添加新的动作方案
2. 重启系统后新方案将被自动加载

### 调整评价标准
1. 修改对应的评价标准Excel文件
2. 确保格式与现有文件一致

## 许可证

MIT License

## 联系方式

如有问题或建议，请联系项目维护者。